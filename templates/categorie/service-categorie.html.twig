{% extends 'base.html.twig' %}

{% block title %}Lenil | Services liées à la catégorie {{ cat.title }}{% endblock %}

{% block body %}
    <div class="wide-header">
        <div class="container-fluid mt-5"> <!-- Container start -->
            <div class="row mt-3">
                <div class="col-md-12">
                    <center>
                        {% if subcat %}
                            <h1>{{ subcat.title }}</h1>
                            <p class="lead pb-5"> {{ subcat.description }} </p>
                        {% else %}
                            <h1>{{ cat.title }}</h1>
                            <p class="lead pb-5"> {{ cat.description }} </p>
                        {% endif %}

                    </center>
                    <hr>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-lg-3 col-md-4 col-sm-12 ">
                    <div class="card border-success mb-3">
                        <div class="card-body pb-2 pt-3 ">
                            <ul class="nav flex-column">
                                <li class="nav-item checkbox checkbox-success">
                                    <label>
                                        <input type="checkbox" value="1" class="get_online_sellers">
                                        <span>Afficher les vendeurs en ligne</span>
                                    </label>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="card border-success mb-3">
                        <div class="card-header bg-success">
                            <h3 class="float-left text-white h5">Categories</h3>
                            <button class="btn btn-secondary btn-sm float-right clear_cat_id clearlink"
                                    onclick="clearCat()">
                                <i class="fa fa-times-circle"></i> Filtre
                            </button>
                        </div>
                        <div class="card-body">
                            <ul class="nav flex-column" id="proposal_category">
                                {% for category in categories %}
                                    <li class="nav-item">
                                       <span class="nav-link {% if category.id == cat.id %} active {% endif %}">
                                            <a href="{{ path('category_services',{categorySlug: category.slug, subcategorySlug: 'services'}) }}"
                                               class="text-success"> {{ category.title }}</a>
                                            <a class="h5 text-success float-right" data-toggle="collapse"
                                               data-target="#cat_{{ category.id }}">
                                            <i class="fa fa-arrow-circle-down"></i></a>
                                        </span>
                                        <ul id="cat_{{ category.id }}" class="collapse">
                                            {% for subcategory in category.sousCategories %}
                                                <li>
                                                    <a class="nav-link text-success {% if subcat and subcat.slug == subcategory.slug %} active {% endif %}" href="{{ path('category_services',{categorySlug: category.slug, subcategorySlug: subcategory.slug}) }}">
                                                        {{ subcategory.title }}
                                                    </a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="card border-success mb-3">
                        <div class="card-header bg-success">
                            <h3 class="float-left text-white h5">Pays du vendeur</h3>
                            <button class="btn btn-secondary btn-sm float-right clear_seller_country clearlink"
                                    onclick="clearCountry()">
                                <i class="fa fa-times-circle"></i> Filtre
                            </button>
                        </div>
                        <div class="card-body">
                            <ul class="nav flex-column">
                                {% for country in filterCountry %}

                                    <li class="nav-item checkbox checkbox-success">
                                        <label>
                                            <input type="checkbox" value="{{ country.id }}" class="get_seller_country">
                                            <span>{{ country.name }}</span>
                                        </label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="card border-success mb-3">
                        <div class="card-header bg-success">
                            <h3 class="float-left text-white h5">Délai de livraison</h3>
                            <button class="btn btn-secondary btn-sm float-right clear_delivery_time clearlink"
                                    onclick="clearDelivery()">
                                <i class="fa fa-times-circle"></i> Filtre
                            </button>
                        </div>
                        <div class="card-body">
                            <ul class="nav flex-column">
                                {% for delai in filterDeliveryTimes %}
                                    <li class="nav-item checkbox checkbox-success">
                                        <label>
                                            <input type="checkbox" value="{{ delai.id }}" class="get_delivery_time">
                                            <span>{{ delai.title }}</span>
                                        </label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="card border-success mb-3">
                        <div class="card-header bg-success">
                            <h3 class="float-left text-white h5">Niveau du vendeur</h3>
                            <button class="btn btn-secondary btn-sm float-right clear_seller_level clearlink"
                                    onclick="clearLevel()">
                                <i class="fa fa-times-circle"></i> Filtre
                            </button>
                        </div>
                        <div class="card-body">
                            <ul class="nav flex-column">
                                {% for level in filterLevels %}

                                    <li class="nav-item checkbox checkbox-success">
                                        <label>
                                            <input type="checkbox" value="{{ level.id }}" class="get_seller_level">
                                            <span>{{ level.name }}</span>
                                        </label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 col-md-8 col-sm-12 ">
                    <div class="row flex-wrap" id="category_proposals">
                        {% for proposal in proposals %}
                            <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-3">
                                <div class="proposal-card-base mp-proposal-card">
                                    <!--- proposal-card-base mp-proposal-card Starts --->
                                    <a href="{{ path('show_details_proposal',{sellerSlug: proposal.seller.slug, proposalSlug: proposal.slug }) }}">
                                        <img src="{{ asset('/uploads/images/'~proposal.proposalImages.first().getFileName()) }}"
                                             class="img-fluid">
                                    </a>
                                    <div class="proposal-card-caption"><!--- proposal-card-caption Starts --->
                                        <div class="proposal-seller-info"><!--- gig-seller-info Starts --->
                                            <span class="fit-avatar s24">
                                                 <img src="{{ asset('/uploads/images/'~proposal.seller.picture) }}"
                                                      class="rounded-circle" width="32" height="32">
                                                                                         </span>
                                            <div class="seller-info-wrapper">
                                                <a href="#ashleytharma1"
                                                   class="seller-name">{{ proposal.seller.Fullname }} </a>
                                                <div class="gig-seller-tooltip">{{ proposal.seller.level.name }}</div>
                                            </div>
                                        </div><!--- gig-seller-info Ends --->
                                        <a href="{{ path('show_details_proposal',{sellerSlug: proposal.seller.slug, proposalSlug: proposal.slug }) }}" class="proposal-link-main">
                                            <h3>{{ proposal.title }}</h3>
                                        </a>
                                        <div class="rating-badges-container">
                                            <span class="proposal-rating">
                                                <svg class="fit-svg-icon full_star" viewBox="0 0 1792 1792"
                                                     xmlns="http://www.w3.org/2000/svg" width="15" height="15">
                                                    <path d="M1728 647q0 22-26 48l-363 354 86 500q1 7 1 20 0 21-10.5 35.5t-30.5 14.5q-19 0-40-12l-449-236-449 236q-22 12-40 12-21 0-31.5-14.5t-10.5-35.5q0-6 2-20l86-500-364-354q-25-27-25-48 0-37 56-46l502-73 225-455q19-41 49-41t49 41l225 455 502 73q56 9 56 46z"></path>
                                                 </svg>
                                                <span>
                                                <strong>{{ proposal.rating }}</strong>
                                                ({{ proposal.views }})
                                                </span>
                                            </span>
                                            <span class="float-right" style="color: #b2b2b2; margin-right: 12px">{{ proposal.seller.pays.name }}</span>
                                        </div>
                                    </div><!--- proposal-card-caption Ends --->
                                    <footer class="proposal-card-footer"><!--- proposal-card-footer Starts --->

                                        <div class="proposal-fav">
                                            <a href="#" data-toggle="modal" data-target="#login-modal">
                                                <i class="fa fa-heart dil1" data-toggle="tooltip" data-placement="top"
                                                   title="Favorite"></i>
                                            </a>
                                        </div>

                                        <div class="proposal-price">
                                            <a class="js-proposal-card-imp-data">
                                                <small>A PARTIR DE</small>{{ proposal.price }} €</a>
                                        </div>
                                    </footer><!--- proposal-card-footer Ends --->
                                </div>
                            </div>
                            {% else %}
                                <div class='col-md-12'>
                                    <h1 class='text-center mt-4'><i class='fa fa-meh-o'></i> Nous n'avons trouvé aucun service correspondant à cette {% if subcat %} sous catégorie {% else %}catégorie {% endif %} </h1>
                                </div>
                        {% endfor %}
                    </div>
                    <div id="wait"></div>
                    <br>
                    <div class="row justify-content-center mb-5 mt-0">
                        <nav>
                            <ul class="pagination" id="search_pagination">

                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
<script type="application/javascript">
function get_category_proposals(){

    var aInputs = $('li').find('.get_online_sellers');
    var online_seller   = Array();
    iKey = 0;
    $.each(aInputs,function(key,oInput){
        if(oInput.checked){
            online_seller[iKey] =  oInput.value
        };
        iKey++;
    });


    var aInputs = $('li').find('.get_delivery_time');
    var delivery   = Array();
    iKey = 0;
    $.each(aInputs,function(key,oInput){
        if(oInput.checked){
            delivery[iKey] =  oInput.value
        };
        iKey++;
    });


    var aInputs = $('li').find('.get_seller_level');
    var level_seller = Array();
    iKey = 0;
    $.each(aInputs,function(key,oInput){
        if(oInput.checked){
            level_seller[iKey] =  oInput.value
        };
        iKey++;
    });
    var aInputs = $('li').find('.get_seller_country');
    var country_seller = Array();
    iKey = 0;
    $.each(aInputs,function(key,oInput){
        if(oInput.checked){
            country_seller[iKey] =  oInput.value
        };
        iKey++;
    });


    $('#wait').addClass("loader");


    $.ajax({
        url:"{{ path('load_category_or_subcategory_proposal') }}",
        data: {
            cat_slug: "{{ catSlug }}",
            sub_cat_slug: "{{ subCatSlug }}",
            json_online_seller: JSON.stringify(online_seller),
            json_delivery: JSON.stringify(delivery),
            json_level_seller: JSON.stringify(level_seller),
            json_country_seller: JSON.stringify(country_seller)
        },
        type:'GET',
        dataType: "JSON",
        success:function(result){
            $('#category_proposals').html('');
            _html = '';
            if (result.count_proposals > 0){
                $.each(result.proposals, function (key, proposal) {
                    _html +='<div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-3">\n' +
                        '                                 <div class="proposal-card-base mp-proposal-card"><!--- proposal-card-base mp-proposal-card Starts --->\n' +
                        '                                     <a href='+proposal.proposalUrl+'>\n' +
                        '                                         <img src='+'/uploads/images/'+ proposal.proposalFirstImage +' class="img-fluid">\n' +
                        '                                     </a>\n' +
                        '                                     <div class="proposal-card-caption"><!--- proposal-card-caption Starts --->\n' +
                        '                                         <div class="proposal-seller-info"><!--- gig-seller-info Starts --->\n' +
                        '                                             <span class="fit-avatar s24">\n' +
                        '                                                 <img src='+'/uploads/images/'+ proposal.sellerAvatar+' class="rounded-circle" width="32" height="32">\n' +
                        '                                                                                         </span>\n' +
                        '                                             <div class="seller-info-wrapper">\n' +
                        '                                                 <a href="#ashleytharma1" class="seller-name">'+ proposal.sellerName+'</a>\n' +
                        '                                                 <div class="gig-seller-tooltip">'+ proposal.sellerLevel+'</div>\n' +
                        '                                             </div>\n' +
                        '                                         </div><!--- gig-seller-info Ends --->\n' +
                        '                                         <a href='+proposal.proposalUrl+' class="proposal-link-main">\n' +
                        '                                             <h3>'+ proposal.proposalTitle+'</h3>\n' +
                        '                                         </a>\n' +
                        '                                         <div class="rating-badges-container">\n' +
                        '                                            <span class="proposal-rating">\n' +
                        '                                                <svg class="fit-svg-icon full_star" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg" width="15" height="15">\n' +
                        '                                                    <path d="M1728 647q0 22-26 48l-363 354 86 500q1 7 1 20 0 21-10.5 35.5t-30.5 14.5q-19 0-40-12l-449-236-449 236q-22 12-40 12-21 0-31.5-14.5t-10.5-35.5q0-6 2-20l86-500-364-354q-25-27-25-48 0-37 56-46l502-73 225-455q19-41 49-41t49 41l225 455 502 73q56 9 56 46z"></path>\n' +
                        '                                                 </svg>\n' +
                        '                                                <span>\n' +
                        '                                                <strong>'+ proposal.proposalRating+'</strong>\n' +
                        '                                                ('+ proposal.proposalViews+')\n' +
                        '                                                </span>\n' +
                        '                                            </span>\n' +
                                                                    '<span class="float-right" style="color: #b2b2b2; margin-right: 12px">'+ proposal.sellerCountry+'</span>'+
                        '                                         </div>\n' +
                        '                                     </div><!--- proposal-card-caption Ends --->\n' +
                        '                                     <footer class="proposal-card-footer"><!--- proposal-card-footer Starts --->\n' +
                        '\n' +
                        '                                         <div class="proposal-fav">\n' +
                        '                                             <a href="#" data-toggle="modal" data-target="#login-modal">\n' +
                        '                                                 <i class="fa fa-heart dil1" data-toggle="tooltip" data-placement="top" title="Favorite"></i>\n' +
                        '                                             </a>\n' +
                        '                                         </div>\n' +
                        '\n' +
                        '                                         <div class="proposal-price">\n' +
                        '                                             <a class="js-proposal-card-imp-data">\n' +
                        '                                                 <small>A PARTIR DE</small>'+ proposal.proposalPrice+' €</a>\n' +
                        '                                         </div>\n' +
                        '                                     </footer><!--- proposal-card-footer Ends --->\n' +
                        '                                 </div>\n' +
                        '                        </div>';
                });
            }else {
                _html +='<div class=\'col-md-12\'>\n<h1 class=\'text-center mt-4\'><i class=\'fa fa-meh-o\'></i> Nous n\'avons trouvé aucun service correspondant à cette recherche </h1>\n</div>';
            }
            $('#category_proposals').html(_html);
            $('#wait').removeClass("loader");
        }
    });


}

$('.get_online_sellers').click(function(){

    get_category_proposals();

});

$('.get_delivery_time').click(function(){

    get_category_proposals();

});

$('.get_seller_level').click(function(){

    get_category_proposals();

});
$('.get_seller_country').click(function(){

    get_category_proposals();

});

    </script>
    <script type="text/javascript">
        $(document).ready(function(){
            $(".get_cat_id").click(function(){
                if($(".get_cat_id:checked").length > 0 ) {
                    $(".clear_cat_id").show();
                }
                else{
                    $(".clear_cat_id").hide();
                }
            });
            $(".get_delivery_time").click(function(){
                if($(".get_delivery_time:checked").length > 0 ) {
                    $(".clear_delivery_time").show();
                }
                else{
                    $(".clear_delivery_time").hide();
                }
            });
            $(".get_seller_level").click(function(){
                if($(".get_seller_level:checked").length > 0 ) {
                    $(".clear_seller_level").show();
                }
                else{
                    $(".clear_seller_level").hide();
                }
            });
            $(".get_seller_country").click(function(){
                if($(".get_seller_country:checked").length > 0 ) {
                    $(".clear_seller_country").show();
                }
                else{
                    $(".clear_seller_country").hide();
                }
            });
            $(".clear_cat_id").click(function(){
                $(".clear_cat_id").hide();
            });
            $(".clear_delivery_time").click(function(){
                $(".clear_delivery_time").hide();
            });
            $(".clear_seller_level").click(function(){
                $(".clear_seller_level").hide();
            });
            $(".clear_seller_country").click(function(){
                $(".clear_seller_country").hide();
            });

        });
        function clearCat(){
            $('.get_cat_id').prop('checked',false);
            get_category_proposals();
        }
        function clearDelivery(){
            $('.get_delivery_time').prop('checked',false);
            get_category_proposals();
        }
        function clearLevel(){
            $('.get_seller_level').prop('checked',false);
            get_category_proposals();
        }
        function clearCountry(){
            $('.get_seller_country').prop('checked',false);
            get_category_proposals();
        }
    </script>
{% endblock %}