{% extends 'base.html.twig' %}
{% block stylesheets %}
    <style>
        input[type=radio]:checked {
            background-color: blue;
            color: #fff;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.css">

{% endblock %}
{% block title %}Créer un service{% endblock %}

{% block body %}

    <div class="container mt-5 mb-5">
        <h1 class="mb-5"><i class="fa fa-plus-circle" aria-hidden="true"></i>
            Proposer un service à vendre</h1>
        <div class="row"><!--- row Starts --->
            <div class="col-md-10">
                <div class="card rounded-0">
                    <div class="card-body">
                        {{ form_start(form) }}
                        <div class="row row-1">
                            <div class="col-md-2 d-md-block d-none">
                                <!--<i class="fa fa-pencil-square-o fa-4x text-success"></i>-->
                                <img style="position:relative; top: -12px; left:15px;" width="64"
                                     src="{{ asset('build/images/comp/book.png') }}">
                            </div>
                            <div class="col-md-10 col-sm-12">
                                <div class="row">
                                    <div class="col-xl-9 col-lg-12">
                                        <div class="form-group">
                                            {{ form_widget(form.title, { 'attr': {'class': 'form-control input-lg','placeholder': 'Titre de votre demande'} }) }}
                                        </div>
                                        <div class="form-group">
                                            {{ form_widget(form.description, { 'attr': {'class': 'form-control','rows': '5','maxlength':"380",'placeholder': 'Description de votre demande'} }) }}
                                            <div class="font-weight-bold pull-right">
                                                <span class="descCount"> 0 </span> / 380 Max
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row-2">
                            <hr class="card-hr">
                            <h5 class="mb-5"> Choisissez une catégorie</h5>
                            <div class="row mb-2 ">
                                <div class="col-md-2 d-md-block d-none">
                                    <!--<i class="fa fa-folder-open fa-4x text-success"></i>-->
                                    <img style="position:relative; top: -12px; left:15px;"
                                         src="{{ asset('build/images/comp/folder.png') }}">
                                </div>
                                <div class="col-md-10 col-sm-12">
                                    <div class="row">
                                        <div class="col-xl-4 col-md-6 mb-2">
                                            {{ form_widget(form.category, { 'attr': {'class': 'form-control'} }) }}

                                        </div>
                                        <div class="col-xl-4 col-md-6 mb-2">
                                            {{ form_widget(form.subcategory, { 'attr': {'class': 'form-control'} }) }}

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row-3">
                            <hr class="card-hr">
                            <h5 class="mb-4"> Délai de livraison du service </h5>
                            <div class="row mb-4">
                                <div class="col-md-1 d-md-block d-none">
                                    <!--<i class="fa fa-clock-o fa-4x text-success "></i>-->
                                    <img style="position:relative; left:15px;"
                                         src="{{ asset('build/images/comp/timetable.png') }}">
                                </div>
                                <div class="col-md-11 col-sm-12 mt-3 ">
                                    <label class="custom-control custom-radio">
                                        {{ form_widget(form.deliveryTime) }}
                                    </label>

                                </div>
                            </div>
                        </div>
                        <div class="row-3">
                            <hr class="card-hr">
                            <h5 class="mb-4"> Images du service </h5>
                            <div class="row mb-4">
                                <div class="col-md-1 d-md-block d-none">
                                    <!--<i class="fa fa-clock-o fa-4x text-success "></i>-->
                                    <img style="position:relative; left:15px;"
                                         src="{{ asset('build/images/comp/edition.png') }}">
                                </div>
                                <div class="col-md-11 col-sm-12 mt-3 ">
                                    <div class="dropzone"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row-4">
                            <hr class="card-hr">
                            <h5 class="mb-4"> Quel est le prix pour ce service ?</h5>
                            <div class="row">
                                <div class="col-md-1 d-md-block d-none">
                                    <!--<i class="fa fa-money fa-4x text-success fa-work"></i>-->
                                    <img style="position:relative; left:15px;"
                                         src="{{ asset('build/images/comp/budget.png') }}">
                                </div>
                                <div class="col-md-6 col-sm-12 offset-md-1 mt-3">
                                    <div class="input-group form-curb">
                                        <span class="input-group-addon font-weight-bold"> € </span>
                                        {{ form_widget(form.price, { 'attr': {'class': 'form-control input-lg','placeholder': "5 Minimum"} }) }}

                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="card-hr">
                        <input type="submit" name="submit" value="Valider" style="cursor:pointer;"
                               class="btn btn-success btn-lg float-right">
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        </div><!--- row Ends --->
    </div>
{% endblock %}
{% block javascripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.js"></script>

    <script>
        $(document).ready(function () {

            $("#appbundle_proposal_description").keydown(function () {
                var textarea = $("#appbundle_proposal_description").val();
                $(".descCount").text(textarea.length);
            });

            $("#appbundle_proposal_subcategory").hide();

            $("#appbundle_proposal_category").change(function () {
                $("#appbundle_proposal_subcategory").show();
            });

        });
        Dropzone.autoDiscover = false;
        var dropzone_default = new Dropzone(".dropzone", {
            url: '{{ path('uploadproposalimagehandler') }}' ,
            maxFiles: 4,
            thumbnailWidth: 120,
            thumbnailHeight: 120,
            dictMaxFilesExceeded: 'Only 4 Images can be uploaded',
            acceptedFiles: 'image/*',
            maxFilesize: 3,  // in Mb
            addRemoveLinks: true,
            init: function () {
                this.on("maxfilesexceeded", function(file) {
                    this.removeFile(file);
                });
                this.on("thumbnail", function(file, xhr, formData) {
                    // send additional data with the file as POST data if needed.
                    // formData.append("key", "value");
                });
                this.on("success", function(file, response) {

                });
            }
        });
    </script>
    <script>
        $('#appbundle_proposal_category').change(function () {
            var categorySelector = $(this);
            // Request the neighborhoods of the selected city.
            $.ajax({
                url: "{{ path('get_sous_category_by_category') }}",
                type: "GET",
                dataType: "JSON",
                data: {
                    catid: categorySelector.val()
                },
                success: function (souscategories) {
                    var sousCategorySelect = $("#appbundle_proposal_subcategory");
                    // Remove current options
                    sousCategorySelect.html('');
                    // Empty value ...
                    sousCategorySelect.append('<option value> Sélectionner une sous catégorie de ' + categorySelector.find("option:selected").text() + ' ...</option>');

                    $.each(souscategories, function (key, souscategory) {
                        sousCategorySelect.append('<option value="' + souscategory.id + '">' + souscategory.title + '</option>');
                    });
                },
                error: function (err) {
                    alert("An error ocurred while loading data ...");
                }
            });
        });
    </script>
{% endblock %}